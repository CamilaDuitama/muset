#!/bin/bash

ls -1 $1 | sort -n -t/ -k2 | xargs -L1 readlink -f | \
awk -F/ '
{
    # Extract the filename without path
    file = $NF

    # Extract the base name by removing _number and all extensions
    if (match(file, /^([^_]+)_[0-9]+/)) {
        # Extract the part before the underscore and number
        base = substr(file, RSTART, RLENGTH-1)
        # Remove the underscore from the base name
        base = substr(base, 1, length(base)-1)
    } else {
        # For files without the pattern, use the full filename without extensions
        base = file
        sub(/\.[^.]*$/, "", base)  # Remove last extension
    }

    # Store the full path in an array indexed by the base name
    paths[base] = paths[base] ? paths[base] " ; " $0 : $0
}

END {
    # Print each base name with its paths
    for (base in paths) {
        print base " : " paths[base]
    }
}' | sort > fof.txt